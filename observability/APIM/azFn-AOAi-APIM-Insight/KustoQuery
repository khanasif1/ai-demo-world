// requests
//  | where isnotnull(customDimensions["Response-Body"])
//  | project customDimensions;

//  tostring(customDimensions["Response-Body"])

//  custDim
//  | summarize customDimensions_Response-Body

requests
| where isnotnull(customDimensions["Response-Body"])
| extend response_body = tostring(parse_json(customDimensions)["Response-Body"])
| extend parsed_body = parse_json(response_body)
| extend usage = parsed_body.usage
| project usage["prompt_tokens"], usage["completion_tokens"], usage["total_tokens"], 
             tostring(parse_json(tostring(parse_json(tostring(parse_json(customDimensions)["Request-Body"]))["messages"]))[0]), 
            parsed_body.model,url
